@page "/Productos"
@using PruebaTecnica.Shared.Entities
@using PruebaTecnica.Web.Repositories
@using PruebaTecnica.Web.Shared
@inject IRepository repository
@inject NavigationManager navigationManager


<h3>Productos</h3>
<div class="mb-3">
    <a class="btn btn-create" href="/products/Create">Crear Producto</a>
</div>

<GenericList MyList="Products">
    <Body>
        <table class="table table-striped table-bordered custom-table">
            <thead>
                <tr>
                    <th>Codigo</th>
                    <th>Nombre</th>
                    <th>Foto</th>
                    <th>Valor</th>
                    <th>Fecha Creación</th>

                </tr>
            </thead>
            <tbody>
                @foreach (var Produt in Products)
                {
                    <tr>
                        <td>@Produt.Code</td>
                        <td>@Produt.NameProduct</td>
                        <td>
                            <div style="height:150px; width:150px;">
                                <img style="width:100%; height:100%" src="@Produt.Photo" />
                            </div>
                        </td>
                        <td>@Produt.CreateDate</td>
                        <td>
                             <a class="btn btn-warning">Editar</a>
                            <button class="btn btn-danger">Borrar</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </Body>
</GenericList>

@code {

    public List<Product> Products { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var responseHttp = await repository.GetAsync<List<Product>>("/api/products");

        // Depuración en la consola
        Console.WriteLine($"¿Hubo error?: {responseHttp.Error}");
        Console.WriteLine($"Cantidad de productos recibidos: {responseHttp.Response?.Count ?? 0}");

        if (!responseHttp.Error && responseHttp.Response != null)
        {
            Products = responseHttp.Response;
        }
        else
        {
            Products = new List<Product>(); // Lista vacía si hay error
        }

        Console.WriteLine($"Cantidad de productos en Products: {Products.Count}");
    }
}